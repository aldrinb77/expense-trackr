<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Expense Trackr</title>

    <!-- Font: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
        rel="stylesheet"
    >

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="logo.png">

    <link rel="stylesheet" href="style.css">

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- App logic -->
    <script src="app.js" defer></script>
</head>
<body>
    <!-- Toasts + global loading overlay -->
    <div id="toast-container"></div>
    <div id="global-loading" class="loading-overlay" style="display: none;">
        <div class="loading-spinner"></div>
        <p>Loading data...</p>
    </div>

    <header class="app-header">
        <div class="header-main">
            <div class="header-left">
                <div class="brand">
                    <div class="brand-logo" aria-hidden="true"></div>
                    <div class="brand-text">
                        <h1>EXPENSE TRACKR</h1>
                        <p class="tagline">Simple, minimal tracking of your daily spending</p>
                    </div>
                </div>
            </div>
            <div class="header-right">
                <nav class="top-nav">
                    <button
                        type="button"
                        class="nav-link"
                        data-scroll-target="summary-card"
                    >
                        Dashboard
                    </button>
                    <button
                        type="button"
                        class="nav-link"
                        data-scroll-target="category-budgets-card"
                    >
                        Budgets
                    </button>
                    <button
                        type="button"
                        class="nav-link"
                        data-scroll-target="charts-card"
                    >
                        Charts
                    </button>
                    <button
                        type="button"
                        class="nav-link"
                        data-scroll-target="transactions-card"
                    >
                        Transactions
                    </button>
                </nav>
                <div class="theme-toggle">
                    <label>
                        <input type="checkbox" id="theme-toggle-checkbox">
                        Dark mode
                    </label>
                </div>
                <button
                    type="button"
                    id="help-button"
                    class="icon-button"
                    aria-label="Help / About this app"
                >
                    ?
                </button>
            </div>
        </div>
    </header>

    <main class="app-main">
        <!-- Account / Profile -->
        <section class="card" id="auth-card">
            <h2>Account</h2>

            <!-- Logged out -->
            <div id="auth-logged-out">
                <p class="muted-text">
                    Log in or create an account to start tracking your expenses.
                    Each account sees only its own data.
                </p>

                <form id="login-form">
                    <h3>Log In</h3>
                    <div class="form-row">
                        <label for="login-username">Username</label>
                        <input
                            type="text"
                            id="login-username"
                            name="login-username"
                            required
                        >
                    </div>
                    <div class="form-row">
                        <label for="login-password">Password</label>
                        <input
                            type="password"
                            id="login-password"
                            name="login-password"
                            required
                        >
                    </div>
                    <p id="login-error" class="form-error"></p>
                    <div class="form-actions">
                        <button type="submit" class="primary-button">
                            Log In
                        </button>
                        <button
                            type="button"
                            class="secondary-button small"
                            id="show-register"
                        >
                            New user? Create an account
                        </button>
                    </div>
                </form>

                <form id="register-form" style="display: none; margin-top: 12px;">
                    <h3>Create Account</h3>
                    <div class="form-row">
                        <label for="register-username">Username</label>
                        <input
                            type="text"
                            id="register-username"
                            name="register-username"
                            required
                        >
                    </div>
                    <div class="form-row">
                        <label for="register-password">Password</label>
                        <input
                            type="password"
                            id="register-password"
                            name="register-password"
                            required
                        >
                    </div>
                    <div class="form-row">
                        <label for="register-password2">Confirm Password</label>
                        <input
                            type="password"
                            id="register-password2"
                            name="register-password2"
                            required
                        >
                    </div>
                    <p id="register-error" class="form-error"></p>
                    <div class="form-actions">
                        <button type="submit" class="primary-button">
                            Register
                        </button>
                        <button
                            type="button"
                            class="secondary-button small"
                            id="show-login"
                        >
                            Already have an account? Log in
                        </button>
                    </div>
                </form>
            </div>

            <!-- Logged in -->
            <div id="auth-logged-in" style="display: none;">
                <div class="profile-row">
                    <div class="profile-avatar" id="profile-avatar"></div>
                    <div class="profile-main">
                        <p class="profile-name">
                            <span>Logged in as</span>
                            <strong id="current-username"></strong>
                        </p>
                        <p class="muted-text" id="profile-member-since">
                            Member since —
                        </p>
                    </div>
                    <button
                        type="button"
                        class="secondary-button"
                        id="logout-button"
                    >
                        Log out
                    </button>
                </div>

                <p class="muted-text" style="margin-top: 6px;">
                    All transactions you add now will be stored under this account.
                </p>

                <div class="profile-stats" id="profile-stats">
                    <div class="profile-stat">
                        <span class="label">Transactions</span>
                        <span class="value" id="profile-total-transactions">0</span>
                    </div>
                    <div class="profile-stat">
                        <span class="label">This month debit</span>
                        <span class="value" id="profile-month-debit">Rs 0.00</span>
                    </div>
                    <div class="profile-stat">
                        <span class="label">This month credit</span>
                        <span class="value" id="profile-month-credit">Rs 0.00</span>
                    </div>
                    <div class="profile-stat">
                        <span class="label">Net</span>
                        <span class="value" id="profile-month-net">Rs 0.00</span>
                    </div>
                </div>

                <div class="profile-stats" id="profile-activity-stats">
                    <div class="profile-stat">
                        <span class="label">Last activity</span>
                        <span class="value" id="profile-last-activity">—</span>
                    </div>
                    <div class="profile-stat">
                        <span class="label">Active days (30d)</span>
                        <span class="value" id="profile-active-days-30">0</span>
                    </div>
                    <div class="profile-stat">
                        <span class="label">Current streak</span>
                        <span class="value" id="profile-current-streak">0</span>
                    </div>
                    <div class="profile-stat">
                        <span class="label">Best streak</span>
                        <span class="value" id="profile-best-streak">0</span>
                    </div>
                </div>

                <div class="profile-actions">
                    <button
                        type="button"
                        class="secondary-button small"
                        id="change-avatar-button"
                    >
                        Change avatar
                    </button>
                </div>
            </div>
        </section>

        <!-- Status -->
        <section class="card">
            <h2>App Status</h2>
            <p id="status-text">If you can see this text, the app is loaded.</p>
        </section>

        <!-- Add Transaction -->
        <section class="card requires-auth" id="add-transaction-card">
            <h2>Add Transaction</h2>
            <form id="transaction-form">
                <div class="form-row">
                    <label for="amount">Amount (Rs)</label>
                    <input
                        type="number"
                        id="amount"
                        name="amount"
                        min="0.01"
                        step="0.01"
                        placeholder="e.g. 100"
                        required
                    >
                </div>

                <div class="form-row">
                    <label for="type">Type</label>
                    <select id="type" name="type" required>
                        <option value="debit">Debit (Expense)</option>
                        <option value="credit">Credit (Income)</option>
                    </select>
                </div>

                <div class="form-row">
                    <label for="category">Category</label>
                    <input
                        type="text"
                        id="category"
                        name="category"
                        placeholder="e.g. Food, Petrol"
                        required
                    >
                </div>

                <div class="quick-categories">
                    <span class="muted-text">Quick categories:</span>
                    <div class="quick-category-chips" id="quick-category-chips">
                        <!-- Chips via JS -->
                    </div>
                </div>

                <div class="form-row">
                    <label for="note">Note (optional)</label>
                    <input
                        type="text"
                        id="note"
                        name="note"
                        placeholder="e.g. Lunch with friends"
                    >
                </div>

                <p id="form-error" class="form-error"></p>

                <div class="form-actions">
                    <button
                        type="submit"
                        class="primary-button"
                        id="transaction-submit-button"
                    >
                        Add Transaction
                    </button>
                    <button
                        type="button"
                        class="secondary-button"
                        id="transaction-cancel-edit"
                        style="display: none;"
                    >
                        Cancel Edit
                    </button>
                </div>
                <p
                    id="editing-hint"
                    class="muted-text editing-hint"
                    style="display: none;"
                >
                    Editing an existing transaction. Change the values and click
                    "Save Changes", or click "Cancel Edit".
                </p>
            </form>
        </section>

        <!-- Date range filter -->
        <section class="card requires-auth" id="date-range-card">
            <h2>Date Range Filter (Optional)</h2>
            <div class="date-range-controls">
                <div class="form-row-inline">
                    <label for="range-preset">Preset</label>
                    <select id="range-preset">
                        <option value="none">All time</option>
                        <option value="today">Today</option>
                        <option value="thisWeek">This Week</option>
                        <option value="thisMonth">This Month</option>
                        <option value="thisYear">This Year</option>
                        <option value="last30">Last 30 Days</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>
                <div class="form-row-inline">
                    <label for="range-from">From</label>
                    <input type="date" id="range-from">
                </div>
                <div class="form-row-inline">
                    <label for="range-to">To</label>
                    <input type="date" id="range-to">
                </div>
                <button
                    type="button"
                    class="secondary-button small"
                    id="range-apply"
                >
                    Apply
                </button>
                <button
                    type="button"
                    class="secondary-button small"
                    id="range-clear"
                >
                    Clear
                </button>
            </div>
            <p id="range-summary-text" class="muted-text" style="margin-top: 6px;">
                No custom date range selected. Showing all transactions.
            </p>
        </section>

        <!-- Summary -->
        <section class="card requires-auth" id="summary-card">
            <h2>Summary</h2>
            <div class="summary-grid">
                <div class="summary-block">
                    <h3>Today</h3>
                    <p>Debit: <span id="today-debit">Rs 0.00</span></p>
                    <p>Credit: <span id="today-credit">Rs 0.00</span></p>
                    <p>Net: <span id="today-net">Rs 0.00</span></p>
                </div>
                <div class="summary-block">
                    <h3>This Week</h3>
                    <p>Debit: <span id="week-debit">Rs 0.00</span></p>
                    <p>Credit: <span id="week-credit">Rs 0.00</span></p>
                    <p>Net: <span id="week-net">Rs 0.00</span></p>
                </div>
                <div class="summary-block">
                    <h3>This Month</h3>
                    <p>Debit: <span id="month-debit">Rs 0.00</span></p>
                    <p>Credit: <span id="month-credit">Rs 0.00</span></p>
                    <p>Net: <span id="month-net">Rs 0.00</span></p>
                </div>
                <div class="summary-block">
                    <h3>This Year</h3>
                    <p>Debit: <span id="year-debit">Rs 0.00</span></p>
                    <p>Credit: <span id="year-credit">Rs 0.00</span></p>
                    <p>Net: <span id="year-net">Rs 0.00</span></p>
                </div>
            </div>

            <div class="summary-overall">
                <h3>Overall Totals</h3>
                <p>Debit: <span id="overall-debit">Rs 0.00</span></p>
                <p>Credit: <span id="overall-credit">Rs 0.00</span></p>
                <p>Net: <span id="overall-net">Rs 0.00</span></p>
            </div>
        </section>

        <!-- Saving goal -->
        <section class="card requires-auth" id="saving-goal-card">
            <h2>Saving Goal (Monthly)</h2>
            <form id="saving-goal-form">
                <div class="form-row">
                    <label for="saving-goal-amount">Monthly saving goal (Rs)</label>
                    <input
                        type="number"
                        id="saving-goal-amount"
                        min="0"
                        step="0.01"
                        placeholder="e.g. 10000"
                    >
                </div>
                <button type="submit" class="secondary-button">Save Goal</button>
                <p id="saving-goal-error" class="form-error"></p>
            </form>

            <p class="muted-text">
                Saving = this month's credit minus this month's debit.
            </p>

            <div class="saving-status">
                <p>Current month net: <span id="saving-current-net">Rs 0.00</span></p>
                <p>Goal: <span id="saving-goal-display">Not set</span></p>
                <p id="saving-goal-status">Set a goal to see your progress.</p>
                <div class="progress-bar">
                    <div class="progress-bar-fill" id="saving-goal-progress"></div>
                </div>
            </div>
        </section>

        <!-- Charts -->
        <section class="card requires-auth" id="charts-card">
            <h2>Insights & Charts</h2>
            <div class="charts-grid">
                <div class="chart-block">
                    <h3>Expenses by Category (This Month)</h3>
                    <canvas id="category-chart"></canvas>
                    <p id="category-chart-empty" class="muted-text">
                        No expense data for this month yet.
                    </p>
                </div>
                <div class="chart-block">
                    <h3>Spending (Debits) – Last 7 Days</h3>
                    <canvas id="daily-chart"></canvas>
                    <p id="daily-chart-empty" class="muted-text">
                        No spending data for the last 7 days.
                    </p>
                </div>
                <div class="chart-block">
                    <h3>Net Cash Flow – Last 90 Days</h3>
                    <canvas id="net-trend-chart"></canvas>
                    <p id="net-trend-chart-empty" class="muted-text">
                        Not enough data for the last 90 days.
                    </p>
                </div>
            </div>
        </section>

        <!-- Category totals -->
        <section class="card requires-auth" id="category-totals-card">
            <h2>Category Totals (This Month)</h2>
            <p class="muted-text">
                Only debit (expense) transactions are included.
            </p>
            <p
                id="top-categories-summary"
                class="muted-text top-categories-summary"
            >
                No expenses yet to highlight top categories.
            </p>
            <table class="category-table">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Amount (Rs)</th>
                        <th>Share of total</th>
                    </tr>
                </thead>
                <tbody id="category-totals-body">
                </tbody>
            </table>
            <p id="category-totals-empty" class="muted-text">
                No expense data for this month yet.
            </p>
        </section>

        <!-- Category budgets -->
        <section class="card requires-auth" id="category-budgets-card">
            <h2>Category Budgets (Monthly)</h2>
            <form id="category-budget-form">
                <div class="form-row">
                    <label for="budget-category">Category</label>
                    <input
                        type="text"
                        id="budget-category"
                        placeholder="e.g. Food"
                        required
                    >
                </div>
                <div class="form-row">
                    <label for="budget-amount">Monthly budget (Rs)</label>
                    <input
                        type="number"
                        id="budget-amount"
                        min="0.01"
                        step="0.01"
                        placeholder="e.g. 5000"
                        required
                    >
                </div>
                <p id="budget-error" class="form-error"></p>
                <div class="form-actions">
                    <button type="submit" class="secondary-button">
                        Save Budget
                    </button>
                </div>
                <p class="muted-text">
                    Re‑saving the same category will update its budget.
                </p>
            </form>

            <p class="muted-text" style="margin-top: 4px;">
                Budgets apply to debit (expense) transactions in the current calendar month.
            </p>

            <table class="category-table" id="category-budgets-table">
                <thead>
                    <tr>
                        <th>Category</th>
                        <th>Budget (Rs)</th>
                        <th>Spent (This Month)</th>
                        <th>Remaining</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="category-budgets-body">
                </tbody>
            </table>
            <p id="category-budgets-empty" class="muted-text">
                No budgets set yet. Add one above.
            </p>
        </section>

        <!-- Transactions -->
        <section class="card requires-auth" id="transactions-card">
            <h2>Transactions</h2>

            <div class="transactions-filters">
                <div class="form-row-inline">
                    <label for="filter-type">Type</label>
                    <select id="filter-type">
                        <option value="all">All</option>
                        <option value="debit">Debits only</option>
                        <option value="credit">Credits only</option>
                    </select>
                </div>
                <div class="form-row-inline">
                    <label for="filter-category">Category</label>
                    <input
                        type="text"
                        id="filter-category"
                        placeholder="e.g. Food"
                    >
                </div>
                <button
                    type="button"
                    class="secondary-button small"
                    id="filter-reset"
                >
                    Clear filters
                </button>
                <button
                    type="button"
                    class="secondary-button small"
                    id="download-csv"
                >
                    Download CSV
                </button>
                <button
                    type="button"
                    class="secondary-button small"
                    id="download-json"
                >
                    Download JSON
                </button>
                <button
                    type="button"
                    class="secondary-button small"
                    id="import-json"
                >
                    Import JSON
                </button>
            </div>

            <input
                type="file"
                id="json-import-input"
                accept="application/json"
                style="display: none;"
            >

            <p id="no-transactions" class="muted-text">
                No transactions yet. Add your first one above.
            </p>
            <p id="no-transactions-filtered" class="muted-text" style="display: none;">
                No transactions match the selected filters.
            </p>

            <ul id="transaction-list" class="transaction-list">
            </ul>
        </section>

        <!-- Help / About modal -->
        <div id="help-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content" role="dialog" aria-labelledby="help-modal-title">
                <h2 id="help-modal-title">About Expense Trackr</h2>
                <p>
                    Expense Trackr is a simple personal finance dashboard. Enter your
                    debits (expenses) and credits (income) in seconds, then see where
                    your money goes, how much you’ve saved, and whether you’re staying
                    within your monthly budgets.
                </p>
                <ul>
                    <li>
                        <strong>Quick entry</strong> – Add a transaction with amount,
                        type, and category. The time is recorded automatically.
                    </li>
                    <li>
                        <strong>Summaries</strong> – View today, this week, this month,
                        and this year at a glance.
                    </li>
                    <li>
                        <strong>Budgets & goals</strong> – Set a monthly saving goal and
                        per‑category budgets with progress bars.
                    </li>
                    <li>
                        <strong>Charts</strong> – Visualize your spending by category,
                        daily debits, and 90‑day net cash flow.
                    </li>
                    <li>
                        <strong>Export & backup</strong> – Download your data as CSV or
                        full JSON backup for restore later.
                    </li>
                </ul>
                <p class="muted-text">
                    Tip: use the date range filter, quick category chips, and dark mode
                    toggle in the header to customize your view.
                </p>
                <div class="modal-actions">
                    <button
                        type="button"
                        class="secondary-button"
                        id="help-modal-close"
                    >
                        Close
                    </button>
                </div>
            </div>
        </div>

        <!-- Avatar modal -->
        <div id="avatar-modal" class="modal-overlay" style="display: none;">
            <div class="modal-content avatar-modal" role="dialog" aria-labelledby="avatar-modal-title">
                <h2 id="avatar-modal-title">Change avatar</h2>
                <div class="avatar-modal-body">
                    <div class="avatar-preview" id="avatar-preview">?</div>
                    <div class="avatar-input">
                        <label class="muted-text" for="avatar-file-input">
                            Upload a square image (max ~200 KB). It will be shown as your profile picture.
                        </label>
                        <input
                            type="file"
                            id="avatar-file-input"
                            accept="image/*"
                        >
                    </div>
                </div>
                <p class="form-error" id="avatar-error"></p>
                <div class="modal-actions">
                    <button
                        type="button"
                        class="secondary-button"
                        id="avatar-remove-button"
                    >
                        Remove avatar
                    </button>
                    <button
                        type="button"
                        class="secondary-button"
                        id="avatar-cancel-button"
                    >
                        Cancel
                    </button>
                    <button
                        type="button"
                        class="primary-button"
                        id="avatar-save-button"
                    >
                        Save
                    </button>
                </div>
            </div>
        </div>
    </main>
</body>
</html>